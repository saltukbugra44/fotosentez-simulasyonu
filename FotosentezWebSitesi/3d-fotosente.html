<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Fotosentez Animasyonu üå±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background: linear-gradient(135deg, #0c4a2a, #1e5631, #2d6835);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
            height: 100vh;
        }

        #container {
            position: relative;
            width: 100%;
            height: 100vh;
        }

        #info-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 20px;
            border-radius: 15px;
            z-index: 100;
            min-width: 300px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 100;
        }

        .control-btn {
            padding: 15px 25px;
            background: linear-gradient(45deg, #4CAF50, #66BB6A);
            color: white;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .control-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(76, 175, 80, 0.5);
        }

        .control-btn:active {
            transform: translateY(0px);
        }

        .control-btn.active {
            background: linear-gradient(45deg, #FF6B6B, #FF8E85);
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-2px) scale(1.05); }
        }

        #phase-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(76, 175, 80, 0.9);
            color: white;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 18px;
            font-weight: bold;
            z-index: 100;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .molecule-info {
            position: absolute;
            background: rgba(0,0,0,0.9);
            color: white;
            padding: 10px 15px;
            border-radius: 10px;
            font-size: 14px;
            pointer-events: none;
            z-index: 1000;
            transform: translate(-50%, -100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .molecule-info.show {
            opacity: 1;
        }

        .info-item {
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .info-label {
            font-weight: bold;
            color: #4CAF50;
            min-width: 100px;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0c4a2a, #1e5631);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }

        .loading-text {
            color: white;
            font-size: 24px;
            margin-bottom: 30px;
            animation: loadingPulse 2s infinite;
        }

        @keyframes loadingPulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .loading-bar {
            width: 300px;
            height: 6px;
            background: rgba(255,255,255,0.2);
            border-radius: 3px;
            overflow: hidden;
        }

        .loading-progress {
            width: 0%;
            height: 100%;
            background: linear-gradient(90deg, #4CAF50, #66BB6A);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        #speed-control {
            position: absolute;
            top: 120px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 100;
        }

        .speed-slider {
            width: 200px;
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            #info-panel {
                width: calc(100% - 40px);
                font-size: 14px;
            }
            
            #controls {
                flex-wrap: wrap;
                max-width: calc(100% - 40px);
            }
            
            .control-btn {
                padding: 12px 20px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-text">üß¨ 3D Fotosentez Modeli Y√ºkleniyor...</div>
        <div class="loading-bar">
            <div class="loading-progress" id="loadingProgress"></div>
        </div>
    </div>

    <div id="container">
        <!-- 3D Scene Container -->
        
        <div id="info-panel">
            <h3 style="color: #4CAF50; margin-bottom: 15px;">üå± 3D Fotosentez Animasyonu</h3>
            <div class="info-item">
                <span class="info-label">Faz:</span>
                <span id="current-phase">Hazƒ±rlanƒ±yor...</span>
            </div>
            <div class="info-item">
                <span class="info-label">Aktif Molek√ºl:</span>
                <span id="active-molecule">-</span>
            </div>
            <div class="info-item">
                <span class="info-label">Enerji Seviyesi:</span>
                <span id="energy-level">0%</span>
            </div>
            <div class="info-item">
                <span class="info-label">ATP √úretimi:</span>
                <span id="atp-count">0 ATP</span>
            </div>
        </div>

        <div id="phase-indicator">
            üìç I≈üƒ±k Absorpsiyonu Fazƒ±
        </div>

        <div id="speed-control">
            <div style="color: #4CAF50; font-weight: bold; margin-bottom: 5px;">Animasyon Hƒ±zƒ±</div>
            <input type="range" min="0.1" max="3" value="1" step="0.1" class="speed-slider" id="speedSlider">
            <div style="font-size: 12px; margin-top: 5px;">Yava≈ü ‚Üê ‚Üí Hƒ±zlƒ±</div>
        </div>

        <div id="controls">
            <button class="control-btn" id="playBtn">‚ñ∂Ô∏è Ba≈ülat</button>
            <button class="control-btn" id="pauseBtn">‚è∏Ô∏è Duraklat</button>
            <button class="control-btn" id="resetBtn">üîÑ Sƒ±fƒ±rla</button>
            <button class="control-btn" id="phaseBtn">‚è≠Ô∏è Sonraki Faz</button>
            <button class="control-btn" id="cameraBtn">üì∑ Kamera A√ßƒ±sƒ±</button>
        </div>
    </div>

    <div class="molecule-info" id="moleculeTooltip"></div>

    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>

    <script>
        // Global variables
        let scene, camera, renderer, controls;
        let chloroplast, thylakoids = [], molecules = [];
        let photons = [], electrons = [];
        let isAnimating = false;
        let currentPhase = 0;
        let animationSpeed = 1;
        let cameraAngle = 0;
        let energyLevel = 0;
        let atpCount = 0;

        // Animation phases
        const phases = [
            "I≈üƒ±k Absorpsiyonu",
            "Su Par√ßalanmasƒ±", 
            "Elektron Ta≈üƒ±ma",
            "ATP Sentezi",
            "Calvin D√∂ng√ºs√º"
        ];

        // Initialize everything
        window.addEventListener('load', function() {
            simulateLoading();
        });

        function simulateLoading() {
            const progress = document.getElementById('loadingProgress');
            let width = 0;
            
            const interval = setInterval(() => {
                width += Math.random() * 15;
                if (width >= 100) {
                    width = 100;
                    progress.style.width = width + '%';
                    setTimeout(() => {
                        document.getElementById('loadingScreen').style.opacity = '0';
                        setTimeout(() => {
                            document.getElementById('loadingScreen').style.display = 'none';
                            init3DScene();
                        }, 500);
                    }, 500);
                    clearInterval(interval);
                } else {
                    progress.style.width = width + '%';
                }
            }, 100);
        }

        function init3DScene() {
            // Scene setup
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x001a0a);
            scene.fog = new THREE.Fog(0x001a0a, 50, 200);

            // Camera setup
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 10, 30);

            // Renderer setup
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            renderer.outputEncoding = THREE.sRGBEncoding;
            document.getElementById('container').appendChild(renderer.domElement);

            // Controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Lighting
            setupLighting();

            // Create 3D objects
            createChloroplast();
            createMolecules();
            setupEventListeners();

            // Start render loop
            animate();
            
            updatePhaseInfo();
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // Directional light (sun)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
            directionalLight.position.set(50, 50, 25);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            scene.add(directionalLight);

            // Point lights for dramatic effect
            const pointLight1 = new THREE.PointLight(0x66ff66, 1, 100);
            pointLight1.position.set(10, 10, 10);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0x66ccff, 0.8, 100);
            pointLight2.position.set(-10, 5, -10);
            scene.add(pointLight2);
        }

        function createChloroplast() {
            // Main chloroplast body
            const chloroplastGeometry = new THREE.SphereGeometry(8, 32, 16);
            chloroplastGeometry.scale(1, 0.6, 1); // Flatten to oval shape
            
            const chloroplastMaterial = new THREE.MeshPhongMaterial({
                color: 0x4CAF50,
                transparent: true,
                opacity: 0.7,
                shininess: 100
            });

            chloroplast = new THREE.Mesh(chloroplastGeometry, chloroplastMaterial);
            chloroplast.castShadow = true;
            chloroplast.receiveShadow = true;
            scene.add(chloroplast);

            // Create thylakoids inside
            createThylakoids();

            // Outer membrane
            const membraneGeometry = new THREE.SphereGeometry(8.5, 32, 16);
            membraneGeometry.scale(1, 0.6, 1);
            const membraneMaterial = new THREE.MeshBasicMaterial({
                color: 0x2E7D32,
                transparent: true,
                opacity: 0.3,
                wireframe: true
            });
            const membrane = new THREE.Mesh(membraneGeometry, membraneMaterial);
            scene.add(membrane);
        }

        function createThylakoids() {
            for (let i = 0; i < 6; i++) {
                const thylakoidGeometry = new THREE.CylinderGeometry(2, 2, 0.5, 16);
                const thylakoidMaterial = new THREE.MeshPhongMaterial({
                    color: 0x66BB6A,
                    shininess: 50,
                    emissive: 0x001100
                });

                const thylakoid = new THREE.Mesh(thylakoidGeometry, thylakoidMaterial);
                thylakoid.position.set(
                    (Math.random() - 0.5) * 10,
                    (Math.random() - 0.5) * 4,
                    (Math.random() - 0.5) * 10
                );
                thylakoid.rotation.x = Math.random() * Math.PI;
                thylakoid.rotation.z = Math.random() * Math.PI;
                
                thylakoid.castShadow = true;
                thylakoid.receiveShadow = true;
                scene.add(thylakoid);
                thylakoids.push(thylakoid);
            }
        }

        function createMolecules() {
            // Create different types of molecules
            const moleculeTypes = [
                { color: 0xff4444, label: 'CO‚ÇÇ', size: 0.8 },
                { color: 0x4444ff, label: 'H‚ÇÇO', size: 0.6 },
                { color: 0xff8800, label: 'O‚ÇÇ', size: 0.9 },
                { color: 0xffff00, label: 'ATP', size: 1.2 },
                { color: 0xff44ff, label: 'NADPH', size: 1.0 }
            ];

            moleculeTypes.forEach((type, typeIndex) => {
                for (let i = 0; i < 5; i++) {
                    const moleculeGeometry = new THREE.SphereGeometry(type.size, 16, 16);
                    const moleculeMaterial = new THREE.MeshPhongMaterial({
                        color: type.color,
                        shininess: 100,
                        emissive: new THREE.Color(type.color).multiplyScalar(0.2)
                    });

                    const molecule = new THREE.Mesh(moleculeGeometry, moleculeMaterial);
                    molecule.position.set(
                        (Math.random() - 0.5) * 40,
                        (Math.random() - 0.5) * 20,
                        (Math.random() - 0.5) * 40
                    );
                    
                    molecule.userData = {
                        type: type.label,
                        originalPosition: molecule.position.clone(),
                        velocity: new THREE.Vector3(
                            (Math.random() - 0.5) * 0.2,
                            (Math.random() - 0.5) * 0.2,
                            (Math.random() - 0.5) * 0.2
                        )
                    };

                    molecule.castShadow = true;
                    scene.add(molecule);
                    molecules.push(molecule);
                }
            });
        }

        function createPhoton(startPos) {
            const photonGeometry = new THREE.SphereGeometry(0.3, 8, 8);
            const photonMaterial = new THREE.MeshBasicMaterial({
                color: 0xffff00,
                emissive: 0xffff00,
                emissiveIntensity: 0.5
            });

            const photon = new THREE.Mesh(photonGeometry, photonMaterial);
            photon.position.copy(startPos || new THREE.Vector3(0, 25, 0));
            
            photon.userData = {
                velocity: new THREE.Vector3(0, -0.5 * animationSpeed, 0),
                life: 100
            };

            scene.add(photon);
            photons.push(photon);
            return photon;
        }

        function createElectron(startPos) {
            const electronGeometry = new THREE.SphereGeometry(0.2, 8, 8);
            const electronMaterial = new THREE.MeshBasicMaterial({
                color: 0x00ffff,
                emissive: 0x004444,
                emissiveIntensity: 0.8
            });

            const electron = new THREE.Mesh(electronGeometry, electronMaterial);
            electron.position.copy(startPos || new THREE.Vector3(0, 0, 0));
            
            electron.userData = {
                angle: 0,
                radius: 3,
                center: startPos.clone(),
                speed: 0.1 * animationSpeed
            };

            scene.add(electron);
            electrons.push(electron);
            return electron;
        }

        function setupEventListeners() {
            // Control buttons
            document.getElementById('playBtn').addEventListener('click', startAnimation);
            document.getElementById('pauseBtn').addEventListener('click', pauseAnimation);
            document.getElementById('resetBtn').addEventListener('click', resetAnimation);
            document.getElementById('phaseBtn').addEventListener('click', nextPhase);
            document.getElementById('cameraBtn').addEventListener('click', switchCamera);

            // Speed control
            document.getElementById('speedSlider').addEventListener('input', function(e) {
                animationSpeed = parseFloat(e.target.value);
            });

            // Mouse interaction
            renderer.domElement.addEventListener('mousemove', onMouseMove);
            
            // Window resize
            window.addEventListener('resize', onWindowResize);
        }

        function startAnimation() {
            isAnimating = true;
            document.getElementById('playBtn').classList.add('active');
            document.getElementById('pauseBtn').classList.remove('active');
            
            // Start phase-specific animations
            switch(currentPhase) {
                case 0: startLightAbsorption(); break;
                case 1: startWaterSplitting(); break;
                case 2: startElectronTransport(); break;
                case 3: startATPSynthesis(); break;
                case 4: startCalvinCycle(); break;
            }
        }

        function pauseAnimation() {
            isAnimating = false;
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.add('active');
        }

        function resetAnimation() {
            isAnimating = false;
            currentPhase = 0;
            energyLevel = 0;
            atpCount = 0;
            
            // Clear all particles
            photons.forEach(photon => scene.remove(photon));
            electrons.forEach(electron => scene.remove(electron));
            photons = [];
            electrons = [];

            // Reset molecules positions
            molecules.forEach(molecule => {
                molecule.position.copy(molecule.userData.originalPosition);
            });

            // Reset UI
            document.getElementById('playBtn').classList.remove('active');
            document.getElementById('pauseBtn').classList.remove('active');
            
            updatePhaseInfo();
        }

        function nextPhase() {
            currentPhase = (currentPhase + 1) % phases.length;
            updatePhaseInfo();
            
            if (isAnimating) {
                startAnimation(); // Restart animation for new phase
            }
        }

        function switchCamera() {
            cameraAngle = (cameraAngle + 1) % 4;
            
            switch(cameraAngle) {
                case 0: // Default view
                    camera.position.set(0, 10, 30);
                    break;
                case 1: // Top view
                    camera.position.set(0, 40, 0);
                    break;
                case 2: // Side view
                    camera.position.set(30, 0, 0);
                    break;
                case 3: // Close up
                    camera.position.set(10, 5, 15);
                    break;
            }
            controls.update();
        }

        function updatePhaseInfo() {
            document.getElementById('current-phase').textContent = phases[currentPhase];
            document.getElementById('phase-indicator').textContent = `üìç ${phases[currentPhase]} Fazƒ±`;
            document.getElementById('energy-level').textContent = Math.floor(energyLevel) + '%';
            document.getElementById('atp-count').textContent = atpCount + ' ATP';
        }

        // Phase-specific animations
        function startLightAbsorption() {
            if (!isAnimating) return;
            
            // Create photons falling from sky
            for (let i = 0; i < 3; i++) {
                setTimeout(() => {
                    if (isAnimating) {
                        createPhoton(new THREE.Vector3(
                            (Math.random() - 0.5) * 20,
                            25,
                            (Math.random() - 0.5) * 20
                        ));
                    }
                }, i * 1000);
            }
            
            // Make chloroplast glow
            chloroplast.material.emissive.setHex(0x002200);
            
            setTimeout(() => {
                if (isAnimating) startLightAbsorption();
            }, 3000 / animationSpeed);
        }

        function startWaterSplitting() {
            if (!isAnimating) return;
            
            // Find H2O molecules and animate splitting
            const waterMolecules = molecules.filter(m => m.userData.type === 'H‚ÇÇO');
            
            waterMolecules.forEach((water, index) => {
                setTimeout(() => {
                    if (isAnimating) {
                        // Create splitting effect
                        water.scale.set(1.5, 1.5, 1.5);
                        water.material.emissive.setHex(0x004444);
                        
                        setTimeout(() => {
                            water.scale.set(1, 1, 1);
                            water.material.emissive.setHex(0x000000);
                            
                            // Create oxygen molecule
                            const oxygen = molecules.find(m => m.userData.type === 'O‚ÇÇ');
                            if (oxygen) {
                                oxygen.position.copy(water.position);
                                oxygen.position.y += 2;
                            }
                            
                            energyLevel += 10;
                        }, 500);
                    }
                }, index * 800);
            });
            
            setTimeout(() => {
                if (isAnimating) startWaterSplitting();
            }, 4000 / animationSpeed);
        }

        function startElectronTransport() {
            if (!isAnimating) return;
            
            thylakoids.forEach((thylakoid, index) => {
                setTimeout(() => {
                    if (isAnimating) {
                        createElectron(thylakoid.position.clone());
                        thylakoid.material.emissive.setHex(0x002200);
                        
                        setTimeout(() => {
                            thylakoid.material.emissive.setHex(0x001100);
                        }, 1000);
                    }
                }, index * 500);
            });
            
            setTimeout(() => {
                if (isAnimating) startElectronTransport();
            }, 3000 / animationSpeed);
        }

        function startATPSynthesis() {
            if (!isAnimating) return;
            
            const atpMolecules = molecules.filter(m => m.userData.type === 'ATP');
            
            atpMolecules.forEach((atp, index) => {
                setTimeout(() => {
                    if (isAnimating) {
                        // ATP synthesis animation
                        atp.scale.set(1.5, 1.5, 1.5);
                        atp.material.emissive.setHex(0x444400);
                        atp.rotation.x += Math.PI;
                        
                        setTimeout(() => {
                            atp.scale.set(1, 1, 1);
                            atp.material.emissive.setHex(0x222200);
                            atpCount++;
                            energyLevel += 5;
                        }, 800);
                    }
                }, index * 600);
            });
            
            setTimeout(() => {
                if (isAnimating) startATPSynthesis();
            }, 3500 / animationSpeed);
        }

        function startCalvinCycle() {
            if (!isAnimating) return;
            
            const co2Molecules = molecules.filter(m => m.userData.type === 'CO‚ÇÇ');
            
            // CO2 fixation animation
            co2Molecules.forEach((co2, index) => {
                setTimeout(() => {
                    if (isAnimating) {
                        // Move CO2 towards center
                        const targetPos = new THREE.Vector3(0, 0, 0);
                        const startPos = co2.position.clone();
                        
                        let progress = 0;
                        const moveInterval = setInterval(() => {
                            progress += 0.02 * animationSpeed;
                            if (progress >= 1) {
                                progress = 1;
                                clearInterval(moveInterval);
                                
                                // Create glucose
                                co2.material.color.setHex(0x884488);
                                co2.userData.type = 'Glucose';
                                energyLevel += 15;
                            }
                            
                            co2.position.lerpVectors(startPos, targetPos, progress);
                        }, 16);
                    }
                }, index * 1000);
            });
            
            setTimeout(() => {
                if (isAnimating) startCalvinCycle();
            }, 5000 / animationSpeed);
        }

        function onMouseMove(event) {
            const mouse = new THREE.Vector2();
            mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;

            const raycaster = new THREE.Raycaster();
            raycaster.setFromCamera(mouse, camera);

            const intersects = raycaster.intersectObjects(molecules);
            
            const tooltip = document.getElementById('moleculeTooltip');
            
            if (intersects.length > 0) {
                const molecule = intersects[0].object;
                tooltip.textContent = molecule.userData.type;
                tooltip.style.left = event.clientX + 'px';
                tooltip.style.top = event.clientY + 'px';
                tooltip.classList.add('show');
                
                document.getElementById('active-molecule').textContent = molecule.userData.type;
            } else {
                tooltip.classList.remove('show');
                document.getElementById('active-molecule').textContent = '-';
            }
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (isAnimating) {
                // Animate molecules
                molecules.forEach(molecule => {
                    molecule.rotation.x += 0.01 * animationSpeed;
                    molecule.rotation.y += 0.015 * animationSpeed;
                    
                    // Float movement
                    molecule.position.add(molecule.userData.velocity);
                    
                    // Boundary check
                    if (Math.abs(molecule.position.x) > 20) molecule.userData.velocity.x *= -1;
                    if (Math.abs(molecule.position.y) > 15) molecule.userData.velocity.y *= -1;
                    if (Math.abs(molecule.position.z) > 20) molecule.userData.velocity.z *= -1;
                });

                // Animate photons
                photons.forEach((photon, index) => {
                    photon.position.add(photon.userData.velocity);
                    photon.userData.life--;
                    
                    // Check collision with chloroplast
                    if (photon.position.distanceTo(chloroplast.position) < 8) {
                        // Hit chloroplast - create energy effect
                        energyLevel += 5;
                        scene.remove(photon);
                        photons.splice(index, 1);
                    } else if (photon.userData.life <= 0) {
                        scene.remove(photon);
                        photons.splice(index, 1);
                    }
                });

                // Animate electrons
                electrons.forEach((electron, index) => {
                    electron.userData.angle += electron.userData.speed;
                    electron.position.x = electron.userData.center.x + Math.cos(electron.userData.angle) * electron.userData.radius;
                    electron.position.z = electron.userData.center.z + Math.sin(electron.userData.angle) * electron.userData.radius;
                    
                    // Remove after full circle
                    if (electron.userData.angle > Math.PI * 4) {
                        scene.remove(electron);
                        electrons.splice(index, 1);
                    }
                });

                // Animate chloroplast
                chloroplast.rotation.y += 0.005 * animationSpeed;
                
                // Animate thylakoids
                thylakoids.forEach(thylakoid => {
                    thylakoid.rotation.y += 0.02 * animationSpeed;
                });

                // Energy decay
                energyLevel = Math.max(0, energyLevel - 0.1);
            }

            controls.update();
            updatePhaseInfo();
            renderer.render(scene, camera);
        }
    </script>
</body>
</html>